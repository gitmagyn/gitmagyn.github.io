<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ranking Elo</title>
  <style>
    /* Reset básico */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      color: #333;
      padding: 20px;
    }
    header {
      text-align: center;
      margin-bottom: 20px;
    }
    h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }
    table {
      width: 100%;
      max-width: 1000px;
      margin: 0 auto;
      border-collapse: collapse;
      background: #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    thead {
      background: #333;
      color: #fff;
    }
    th, td {
      padding: 12px 15px;
      text-align: center;
      border-bottom: 1px solid #ddd;
    }
    tbody tr:hover {
      background: #f1f1f1;
    }
    img.flag {
      width: 32px;
      height: auto;
    }
    #admin-panel {
      max-width: 1000px;
      margin: 20px auto;
      background: #fff;
      padding: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    #admin-panel h2 {
      margin-bottom: 10px;
    }
    #admin-panel form {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    #admin-panel input[type="text"],
    #admin-panel input[type="number"] {
      flex: 1;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    #admin-panel button {
      padding: 8px 15px;
      border: none;
      background: #333;
      color: #fff;
      border-radius: 4px;
      cursor: pointer;
    }
    #admin-panel button:hover {
      background: #555;
    }
    .edit-btn, .delete-btn {
      padding: 5px 10px;
      border: none;
      color: #fff;
      border-radius: 4px;
      cursor: pointer;
      margin: 0 2px;
    }
    .edit-btn {
      background: #007BFF;
    }
    .edit-btn:hover {
      background: #0056b3;
    }
    .delete-btn {
      background: #dc3545;
    }
    .delete-btn:hover {
      background: #c82333;
    }
  </style>
</head>
<body>
  <header>
    <h1>Ranking Elo</h1>
    <p>Ranking de jogadores com pontuações pré-definidas</p>
  </header>

  <!-- Painel de Administração: exibido somente se o parâmetro token estiver correto -->
  <div id="admin-panel" style="display:none;">
    <h2>Adicionar Novo Jogador</h2>
    <form id="add-player-form">
      <input type="text" id="nome" placeholder="Nome do Jogador" required>
      <input type="number" id="elo" placeholder="Elo" required>
      <input type="text" id="pais" placeholder="País" required>
      <input type="text" id="flag" placeholder="URL da Bandeira" required>
      <button type="submit">Adicionar Jogador</button>
    </form>
  </div>

  <table>
    <thead>
      <tr id="table-header">
        <th>Posição</th>
        <th>Bandeira</th>
        <th>Jogador</th>
        <th>Elo</th>
        <!-- A coluna de Ação (edit e delete) será adicionada para admin -->
      </tr>
    </thead>
    <tbody id="ranking-body">
      <!-- As linhas serão inseridas via JavaScript -->
    </tbody>
  </table>

  <script>
    // Coloque aqui o link da sua API do Repl.it
    const API_URL = "https://8a7b7e9e-26e4-4c56-96f2-ff9d7e38aeaf-00-27yl2tvgyn416.picard.replit.dev/"; // Exemplo: "https://meu-servidor-replit.herokuapp.com"

    // Verifica se o usuário é admin com base no parâmetro da URL
    const params = new URLSearchParams(window.location.search);
    const isAdmin = params.get("token") === "isadmintrue";

    // Se for admin, exibe o painel de administração e adiciona coluna de ação à tabela
    if (isAdmin) {
      document.getElementById("admin-panel").style.display = "block";
      const headerRow = document.getElementById("table-header");
      const thAcao = document.createElement("th");
      thAcao.textContent = "Ação";
      headerRow.appendChild(thAcao);
    }

    // Função para buscar os jogadores do servidor
    async function fetchPlayers() {
      try {
        const response = await fetch(API_URL + "/players");
        const data = await response.json();
        return data;
      } catch (error) {
        console.error("Erro ao buscar jogadores:", error);
        return [];
      }
    }

    // Função para renderizar a tabela de jogadores
    async function renderTable() {
      let jogadores = await fetchPlayers();

      // Ordena os jogadores pelo Elo de forma decrescente
      jogadores.sort((a, b) => b.elo - a.elo);
      const tbody = document.getElementById("ranking-body");
      tbody.innerHTML = "";

      jogadores.forEach((jogador, index) => {
        const tr = document.createElement("tr");

        // Coluna de Posição
        const tdPos = document.createElement("td");
        tdPos.textContent = index + 1;
        tr.appendChild(tdPos);

        // Coluna de Bandeira (apenas imagem)
        const tdBandeira = document.createElement("td");
        const img = document.createElement("img");
        img.src = jogador.flag;
        img.alt = jogador.pais;
        img.className = "flag";
        tdBandeira.appendChild(img);
        tr.appendChild(tdBandeira);

        // Coluna de Nome do Jogador
        const tdNome = document.createElement("td");
        tdNome.textContent = jogador.nome;
        tr.appendChild(tdNome);

        // Coluna de Elo
        const tdElo = document.createElement("td");
        tdElo.textContent = jogador.elo;
        tr.appendChild(tdElo);

        // Coluna de Ação (só para admin)
        if (isAdmin) {
          const tdAcao = document.createElement("td");
          
          // Botão de Editar
          const btnEdit = document.createElement("button");
          btnEdit.textContent = "Edit";
          btnEdit.className = "edit-btn";
          btnEdit.addEventListener("click", () => editPlayer(jogador.id));
          tdAcao.appendChild(btnEdit);
          
          // Botão de Deletar
          const btnDelete = document.createElement("button");
          btnDelete.textContent = "Delete";
          btnDelete.className = "delete-btn";
          btnDelete.addEventListener("click", () => deletePlayer(jogador.id));
          tdAcao.appendChild(btnDelete);
          
          tr.appendChild(tdAcao);
        }

        tbody.appendChild(tr);
      });
    }

    // Função para adicionar novo jogador
    async function addPlayer(jogador) {
      try {
        await fetch(API_URL + "/players", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(jogador)
        });
        renderTable();
      } catch (error) {
        console.error("Erro ao adicionar jogador:", error);
      }
    }

    // Função para editar jogador
    async function editPlayer(id) {
      const novoNome = prompt("Editar nome do jogador:");
      const novoElo = prompt("Editar Elo do jogador:");
      if (novoNome === null || novoElo === null) return;
      const updatedData = {
        nome: novoNome.trim(),
        elo: parseInt(novoElo)
      };
      try {
        await fetch(API_URL + "/players/" + id, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(updatedData)
        });
        renderTable();
      } catch (error) {
        console.error("Erro ao editar jogador:", error);
      }
    }

    // Função para deletar jogador
    async function deletePlayer(id) {
      if (!confirm("Tem certeza que deseja deletar este jogador?")) return;
      try {
        await fetch(API_URL + "/players/" + id, {
          method: "DELETE"
        });
        renderTable();
      } catch (error) {
        console.error("Erro ao deletar jogador:", error);
      }
    }

    // Manipula o envio do formulário de adição de novo jogador (modo admin)
    if (isAdmin) {
      document.getElementById("add-player-form").addEventListener("submit", async (e) => {
        e.preventDefault();
        const nomeInput = document.getElementById("nome");
        const eloInput = document.getElementById("elo");
        const paisInput = document.getElementById("pais");
        const flagInput = document.getElementById("flag");

        const novoJogador = {
          nome: nomeInput.value.trim(),
          elo: parseInt(eloInput.value),
          pais: paisInput.value.trim(),
          flag: flagInput.value.trim()
        };

        await addPlayer(novoJogador);

        nomeInput.value = "";
        eloInput.value = "";
        paisInput.value = "";
        flagInput.value = "";
      });
    }

    // Renderiza a tabela ao carregar a página
    renderTable();
  </script>
</body>
</html>
